<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.TextParameterDefinition>
          <name>USER</name>
          <description>Linux user under whose home directory you want to setup TPCDS on master machine</description>
          <defaultValue>testuser</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>MASTER_IP</name>
          <description>IP of master machine where spark and hadoop is setup and TPCDS benchmark to be run</description>
          <defaultValue>9.3.126.18</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>DB_SIZE</name>
          <description>Size of tpcds DB in GB  e.g. 1/3/5</description>
          <defaultValue>1</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>QUERIES</name>
          <description>queries you want to run on tpcds DB e.g. (q1,q5,q12)</description>
          <defaultValue>q3,q19</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>QUERY_ITERATION</name>
          <description>Number of iteration of execution of query.Please enter new value if you want to change</description>
          <defaultValue>2</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>DRIVER_MEM</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2g</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>DRIVER_CORES</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>EXEC_MEM_OVERHEAD</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>136</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>SHUFFLE_PARTITIONS</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>4</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>NUM_EXECUTORS</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>EXEC_CORES</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>EXEC_MEM</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2g</defaultValue>
        </hudson.model.TextParameterDefinition>
        <hudson.model.TextParameterDefinition>
          <name>GC_THREADS</name>
          <description>Default config parameter to run TPCDS. Please enter new value if you want to change it as per your environment</description>
          <defaultValue>2</defaultValue>
        </hudson.model.TextParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <jenkins.triggers.ReverseBuildTrigger>
      <spec></spec>
      <upstreamProjects>Run_setup_tpcds</upstreamProjects>
      <threshold>
        <name>SUCCESS</name>
        <ordinal>0</ordinal>
        <color>BLUE</color>
        <completeBuild>true</completeBuild>
      </threshold>
    </jenkins.triggers.ReverseBuildTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -e

jenkins_ip=$(/sbin/ip -o -4 addr list eth0 | awk &apos;{print $4}&apos; | cut -d/ -f1)
jenkins_user=$( whoami )

last_commit_hash=`cat ~/build_dist_jenkins_var | grep ^last_commit_hash | cut -f2 -d&quot;=&quot;`
git_url=`cat ~/build_dist_jenkins_var | grep ^git_url | cut -f2 -d&quot;=&quot;`

home_dir=$(ssh $USER@$MASTER_IP &apos;pwd&apos;)

ssh $USER@$MASTER_IP /bin/bash &lt;&lt;EOT
cd $home_dir/tpcds-setup
echo &apos;Running queries - &apos;$queries&apos;&apos;
./run_single.sh $QUERIES $QUERY_ITERATION $NUM_EXECUTORS $EXEC_CORES $EXEC_MEM tpcds${DB_SIZE}G
EOT

echo &quot;------------------------------------------------&quot;

#ssh $USER@$MASTER_IP /bin/bash &lt;&lt;EOT
#cd $home_dir/tpcds-setup
#echo &apos;Running run_throughput.sh&apos;
#./run_throughput.sh $NUM_EXECUTORS $EXEC_CORES $EXEC_MEM tpcds${DB_SIZE}G 200
#EOT

echo &quot;------------------------------------------------&quot;

echo &apos;Parsing the logs and creating json file&apos;
ssh $USER@$MASTER_IP /bin/bash &lt;&lt;EOF
logDir=$home_dir/tpcds-setup/logs
log_file_name=\$(ls -lrt  \${logDir} | grep nohup | tail -1 | awk -F &quot; &quot; &apos;{print  \$9 }&apos;)
json_file_name=\$(echo \$log_file_name | cut -f 1 -d &apos;.&apos;).json
master=${MASTER_IP}
log_file=\${logDir}/\${log_file_name}
json_file=\$(echo \$log_file | cut -f 1 -d &apos;.&apos;).json

rm -rf parseTPCDSlogsMongoDB
git clone --recursive --depth 1 https://github.com/nirmannarang/parseTPCDSlogsMongoDB.git -b deploy
cd parseTPCDSlogsMongoDB
python tpcdsExtractJSONtoMongoDB.py \${log_file} ${git_url} ${last_commit_hash} \${master}
curl -i -X POST -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d @\${json_file_name} http://9.3.126.252:9000/api/t_benchmark
rm -rf \${json_file}
EOF</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>